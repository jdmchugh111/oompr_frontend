document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('useLocation').addEventListener('click', function() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        const url = `/geocoder/city_from_location?latitude=${latitude}&longitude=${longitude}`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.city) {
              document.getElementById('city').value = data.city;
            } else {
              alert(data.error || 'City not found');
            }
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Unable to retrieve city');
          });
      }, function(error) {
        console.error('Error:', error);
        alert('Unable to retrieve location');
      });
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  });
});
